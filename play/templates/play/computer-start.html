{% extends 'home/base.html' %}

{% load static %}

{% block style %}

{% endblock style %}

{% block content %}


	<section id="body" class="mt-3">

		<div class="container text-center text-light mb-1">
			<h5 class="game-message" data-id="{{ points }}">You Vs. Computer</h5>
		</div>

		<div class="container">
			<table class="table table-bordered table-dark text-center">
			  <thead>
			    <tr>
			      <th scope="col">You</th>
			      <th scope="col">Computer</th>
			    </tr>
			  </thead>
			  
			  <tbody>
			    <tr>
			      <td class="user_td"><img src="{% static 'home/image/rps-logo.jpg' %}" class="rps-icon user-icon"/></td>
			      <td class="computer_td"><img src="{% static 'home/image/rps-logo.jpg' %}" class="rps-icon computer-icon"/></td>
			    </tr>

			    <tr class="bg-warning">
			      <td class="text-dark font-weight-bolder">Score : <span class="human-score">0</span></td>
			      <td class="text-dark font-weight-bolder">Score : <span class="computer-score">0</span></td>
			    </tr>
			  </tbody>

			</table>
		</div>
	</section>

	<script type="text/javascript">
	const d=document,user_icon_elem=d.getElementsByClassName("user-icon")[0],computer_icon_elem=d.getElementsByClassName("computer-icon")[0],game_message_elem=d.getElementsByClassName("game-message")[0],human_score_elem=d.getElementsByClassName("human-score")[0],computer_score_elem=d.getElementsByClassName("computer-score")[0],gamePoint=game_message_elem.getAttribute("data-id"),keyChoices=["r","p","s"],imageChoices=["rock","paper","scissor"];var user_score=0,computer_score=0;function userWins(){$(".result-tag").html("Congratulation ðŸ˜ŠðŸ˜Ž"),$(".result-message").html("You won the game against Computer.")}function computerWins(){$(".result-tag").html("Oops ðŸ˜¥ðŸ˜¥"),$(".result-message").html("You lost the game against Computer.")}document.onkeyup=function(e){if(user_score==gamePoint||computer_score==gamePoint)return location.reload(),!1;keyPressed=e.key.toLowerCase(),keyChoices.includes(keyPressed)?(keyPosition=keyChoices.indexOf(keyPressed),0==keyPosition?user_icon_elem.setAttribute("src","{% static 'home/image/rock.png' %}"):1==keyPosition?user_icon_elem.setAttribute("src","{% static 'home/image/paper.png' %}"):user_icon_elem.setAttribute("src","{% static 'home/image/scissor.png' %}"),$.ajax({type:"GET",url:"{% url 'play:who-win' %}",data:{keyPressed:imageChoices[keyPosition]},success:function(e){computerChoice=e.computerChoice,0==computerChoice?computer_icon_elem.setAttribute("src","{% static 'home/image/rock.png' %}"):1==computerChoice?computer_icon_elem.setAttribute("src","{% static 'home/image/paper.png' %}"):computer_icon_elem.setAttribute("src","{% static 'home/image/scissor.png' %}"),userWin=e.userWin,"Tie"!=userWin?(userWin?game_message_elem.innerHTML="You win 1 point":game_message_elem.innerHTML="You loose 1 point",userWin?user_score+=1:computer_score+=1):game_message_elem.innerHTML="This was a tie",human_score_elem.innerHTML=user_score,computer_score_elem.innerHTML=computer_score,user_score!=gamePoint&&computer_score!=gamePoint||(user_score==gamePoint?userWins():computerWins(),$("#result-message-modal").modal("show"))}})):alert("You have only three Choices - r,p,s")};
	</script>



	<!-- <script>
		/*
			r - Rock
			p - Paper
			s - Scissor
		*/
		const d = document;
		const user_icon_elem = d.getElementsByClassName("user-icon")[0];
		const computer_icon_elem = d.getElementsByClassName("computer-icon")[0];
		const game_message_elem = d.getElementsByClassName("game-message")[0];
		const human_score_elem = d.getElementsByClassName("human-score")[0];
		const computer_score_elem = d.getElementsByClassName("computer-score")[0];
		const gamePoint = game_message_elem.getAttribute('data-id');

		const keyChoices = ['r','p','s'];
		const imageChoices = ['rock','paper','scissor'];

		var user_score = 0;
		var computer_score = 0; 

		function userWins() {
			$(".result-tag").html("Congratulation ðŸ˜ŠðŸ˜Ž");
			$(".result-message").html("You won the game against Computer.");
		}
		function computerWins(){
			$(".result-tag").html("Oops ðŸ˜¥ðŸ˜¥");
			$(".result-message").html("You lost the game against Computer.");		
		}

		document.onkeyup = function(event) {

			if(user_score == gamePoint ||  computer_score == gamePoint) {
				location.reload();			
				return false;
			}
			else {
				keyPressed = event.key.toLowerCase();			
				if(keyChoices.includes(keyPressed)) {
					//Key is present in choices
					keyPosition = keyChoices.indexOf(keyPressed);
					
					if(keyPosition == 0) {
						user_icon_elem.setAttribute("src","{% static 'home/image/rock.png' %}");
					}
					else if(keyPosition == 1) {
						user_icon_elem.setAttribute("src","{% static 'home/image/paper.png' %}");
					} 
					else {
						user_icon_elem.setAttribute("src","{% static 'home/image/scissor.png' %}");
					}
					$.ajax({
						type:'GET',
						url:"{% url 'play:who-win' %}",
						data:{
							'keyPressed':imageChoices[keyPosition]
						},
						success:function(json){
							//success
							computerChoice = json.computerChoice;
							if(computerChoice == 0) {
								computer_icon_elem.setAttribute("src","{% static 'home/image/rock.png' %}");
							}
							else if(computerChoice == 1) {
								computer_icon_elem.setAttribute("src","{% static 'home/image/paper.png' %}");
							}
							else {
								computer_icon_elem.setAttribute("src","{% static 'home/image/scissor.png' %}");
							}
							userWin = json.userWin;
							if(userWin != "Tie") {
								(userWin)?game_message_elem.innerHTML="You win 1 point":game_message_elem.innerHTML="You loose 1 point";
								(userWin)?user_score += 1:computer_score += 1;
							}else {
								game_message_elem.innerHTML="This was a tie";
							}
							human_score_elem.innerHTML = user_score;
							computer_score_elem.innerHTML = computer_score;

							if(user_score == gamePoint || computer_score == gamePoint) {
								//game is complete and final result is decided
								(user_score==gamePoint)?userWins():computerWins();
								$("#result-message-modal").modal("show");
							}

						}
					})
				}
				else {
					alert("You have only three Choices - r,p,s");
				}
			}
		}			

	</script> -->

	<div class="modal modal-fade" id="result-message-modal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h3 class="result-tag"></h3>
					<button type="button" class="close" onfocus="this.style.outline='none'" data-dismiss="modal"><span>&times;</span></button>
				</div>
				<div class="modal-body">
					<p class="lead result-message"></p>
					<div class="d-flex justify-content-center">
						<a href="#" class="mr-2" onclick='location.reload()'>Play Again</a>
						<a href="{% url 'home:home' %}" class="ml-2">Go Home</a>
					</div>
				</div>
			</div>
		</div>
	</div> 


{% if instruction %}
	
	<div class="modal modal-fade" id="message-modal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h3>Instructions</h3>
					<button type="button" class="close" onfocus="this.style.outline='none'" data-dismiss="modal"><span>&times;</span></button>
				</div>
				<div class="modal-body">
					<p class="lead">{{ instruction|safe }}</p>
				</div>
			</div>
		</div>
	</div> 

	<script>
		$("#message-modal").modal('show');
	</script>



{% endif %}

{% endblock content %}